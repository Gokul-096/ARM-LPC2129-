#include<lpc21xx.h>
#include<stdlib.h>
#include<string.h>
#include "lcd_header.h"
char sec,min,hr,date,ch,mon,yr,day;
int i=0;
void i2c_init(void);
void start(void);
void write(char);
void stop(void);
void read(void);
char i2c_nack(void);
void nack(void);
int main()
{

i2c_init();
lcd_init();
write(0xd0);
write(0x00);
write(0x45);
write(0x12);
write(0x09);
write(0x05);
write(0x31);
write(0x10);
write(0x25);
stop();
delay(1000);
lcd_cmd(0x80);
read();

}
void i2c_init(void)
{
PINSEL0 |=0X50;
//IOSET0=1;
I2SCLL=75;
I2SCLH=75;
I2CONSET=1<<6;
start();

}
void start(void)
{
I2CONSET=1<<5;
I2CONCLR=1<<3;
while(((I2CONSET>>3)&1)==0);
I2CONCLR=1<<5;
}
void write(char x)
{
I2DAT=x;
I2CONCLR=1<<3;
while(((I2CONSET>>3)&1)==0);
}
void stop(void)
{
I2CONSET=1<<4;
I2CONCLR=1<<3;
}
void read(void)
{
while(1)
{
start();
write(0xd0);
write(0x00);
start();
write(0xd1);

sec=i2c_nack();
min=i2c_nack();
hr=i2c_nack();
day=i2c_nack();
date=i2c_nack();
mon=i2c_nack();
yr=i2c_nack();
nack();
stop();
lcd_cmd(0x84);
lcd_data((sec %16) + 0x30);
lcd_data((sec %16) + 0x30);      
lcd_data(':');
lcd_data((min %16) + 0x30);
lcd_data((min %16) + 0x30);      

lcd_data(':');
lcd_data((hr %16) + 0x30);
lcd_data((hr %16) + 0x30);      

lcd_data(':');
lcd_data((date %16) + 0x30);
lcd_data((date %16) + 0x30);      

lcd_cmd(0xc5);
lcd_data((mon %16) + 0x30);
lcd_data((mon %16) + 0x30);      

lcd_data(':');
lcd_data((yr %16) + 0x30);
lcd_data((yr %16) + 0x30);      
lcd_data(':');
lcd_data((ch %16) + 0x30);
lcd_data((ch %16) + 0x30);  
lcd_data(':');
lcd_data((ch %16) + 0x30);
lcd_data((ch %16) + 0x30);  

}

}
char i2c_nack(void)
{
I2CONSET=1<<2;
I2CONCLR=1<<3;
while(((I2CONSET>>3)&1)==0);
ch=I2DAT;
return ch;
}
 void nack(void)
{
I2CONCLR=1<<2;
I2CONCLR=1<<3;
while(((I2CONSET>>3)&1)==0);
}