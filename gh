#include<lpc21xx.h>
#include<string.h>
#define LED 1<<8
void delay(int ms);
char ID[13];
char s2[13];
int r_i=0,t_i=0;
int len=12;
int check=0;


void UART0_ISR(void) __irq
{
	unsigned char temp;
	unsigned char c;
	temp=U0IIR;
	temp&=0x0E;
	if(temp==0x04)
	{
		if(r_i<len)
		{
		c=U0RBR;
		ID[r_i++]=c;
		if(r_i==len)
		{
			ID[r_i]='\0';
			r_i=0;
			strcpy(s2,ID);
			check=1;	
		}
	   }
	   }

 
	/*else if(temp==0x02)
	{
		if(t_i<len)
		{
			U0THR=ID[t_i++];
		}
		else
		{
			t_i=0;
			U0IER&=~(1<<1);
		}
	} */
	VICVectAddr=0;
}
void UART0_CONFIG(void)
{
	PINSEL0=0x05;
	U0LCR=0x83;
	U0DLL=97;
	U0DLM=0;
	U0LCR=0x03;
}
void UART0_INT_CONFIG(void)
{
	VICIntSelect=0<<6;
	VICVectCntl0=(0x20)|6;
	VICVectAddr0=(unsigned long)UART0_ISR;
	U0IER|=1<<0;
	VICIntEnable=1<<6;
}
void delay(int ms)
{
	T0PR=15000-1;
	T0TCR=0x01;
	while(T0TC<ms);
	T0TCR=0x03;
	T0TCR=0x00;
}

int main()
{
	char s1[]="060066DF942B";
	IODIR0=LED;
	IOSET0=LED;
	UART0_CONFIG();
	UART0_INT_CONFIG();
	while(1)
	{
		if(check==1)
		{
			strcpy(s2,ID);
			check=0;
			/*t_i=0;
			 U0IER|=1<<1;
			U0THR=ID[t_i++];*/
		IOSET0=LED;
		if(strcmp(s2,s1)==0)
		{
			IOCLR0=LED;
			delay(1000);
			IOSET0=LED;
		}
		}
	
		
	}
}